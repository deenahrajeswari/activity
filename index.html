<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MY To-Do list ‚ù§Ô∏è</title>
  <link href="style.css" rel="stylesheet">
</head>

<body>
  <div class="container">

    <div class="todolist">
      <h1>

        <img src="icon.jpeg" alt="icon" class="logo"> TO-DO LIST
      </h1>

      <div class="task-box">
        <div class="input-row">
          <input type="text" id="taskInput" placeholder="Enter a task">
          <button id="addBtn">Add</button>
        </div>
        
    

        <div class="row tasks-and-motivation">
          <ul id="taskList"></ul>

          <div class="motivation">
            <img src="mot.jpeg" alt="Motivational Image">
          </div>

        </div>

        <img id="victoryImg" src="victory.jpeg" alt="Victory!">

      </div>
    </div>
  </div>


  <script type="module">
    // Import Firebase SDKs from CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp }
      from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    // Your Firebase configuration
    const firebaseConfig = {
      
      authDomain: "my-to-d0.firebaseapp.comgit",
      projectId: "my-to-d0",
      storageBucket: "my-to-d0.firebasestorage.app",
      messagingSenderId: "820680960546",
      appId: "1:820680960546:web:60843763935c4d0790787b",
      measurementId: "G-GJGEQW6ST7"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const taskInput = document.getElementById("taskInput");
    const addBtn = document.getElementById("addBtn");
    const taskList = document.getElementById("taskList");
    const victoryImg = document.getElementById('victoryImg');

    const tasksCol = collection(db, "tasks");

    // Victory check function
    function checkVictory() {
      // Use setTimeout to ensure DOM is fully updated
      setTimeout(() => {
        const tasks = document.querySelectorAll('#taskList li');
        const completed = document.querySelectorAll('#taskList li .task-checkbox:checked');

        console.log(`Total tasks: ${tasks.length}, Completed: ${completed.length}`); // Debug log

        if (tasks.length > 0 && tasks.length === completed.length) {
          console.log("üéâ All tasks completed! Showing victory image"); // Debug log
          victoryImg.style.display = 'block';
          victoryImg.classList.add('show');
        } else {
          console.log("Tasks remaining or no tasks"); // Debug log
          victoryImg.classList.remove('show');
          // Don't immediately hide, let animation complete
          setTimeout(() => {
            if (!victoryImg.classList.contains('show')) {
              victoryImg.style.display = 'none';
            }
          }, 300);
        }
      }, 100); // Small delay to ensure DOM is updated
    }

    // Real-time listener for tasks
    onSnapshot(tasksCol, (snapshot) => {
      taskList.innerHTML = "";

      let taskCount = 0;
      let completedCount = 0;

      snapshot.forEach((docSnap) => {
        const task = docSnap.data();
        taskCount++;
        if (task.completed) completedCount++;

        const li = document.createElement("li");
        li.dataset.id = docSnap.id;

        // ‚úÖ Checkbox
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = task.completed;
        checkbox.classList.add("task-checkbox");

        // ‚úÖ Task text
        const span = document.createElement("span");
        span.textContent = task.text;
        span.classList.add("task-text");
        if (task.completed) span.classList.add("completed");

        // ‚úÖ Delete button
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "X";
        deleteBtn.classList.add("deleteBtn");

        // ‚úÖ Add to li
        li.appendChild(checkbox);
        li.appendChild(span);
        li.appendChild(deleteBtn);
        taskList.appendChild(li);
      });

      console.log(`Firebase data - Tasks: ${taskCount}, Completed: ${completedCount}`); // Debug log

      // Check victory after DOM is updated
      checkVictory();
    });

    // Add task
    addBtn.addEventListener("click", async () => {
      const text = taskInput.value.trim();
      if (!text) return;

      try {
        await addDoc(tasksCol, {
          text,
          completed: false,
          createdAt: serverTimestamp()
        });
        taskInput.value = "";
      } catch (error) {
        console.error("Error adding task:", error);
        alert("Error adding task. Please try again.");
      }
    });

    // Handle clicks (complete/delete)
    taskList.addEventListener("click", async (e) => {
      const li = e.target.closest("li");
      if (!li) return;
      const id = li.dataset.id;

      try {
        if (e.target.classList.contains("deleteBtn")) {
          await deleteDoc(doc(db, "tasks", id));
        }

        if (e.target.classList.contains("task-checkbox")) {
          const isCompleted = e.target.checked;

          // Update the task text style immediately for better UX
          const taskText = li.querySelector('.task-text');
          if (isCompleted) {
            taskText.classList.add('completed');
          } else {
            taskText.classList.remove('completed');
          }

          // Check victory immediately on checkbox change
          setTimeout(() => checkVictory(), 50);

          await updateDoc(doc(db, "tasks", id), { completed: isCompleted });
        }
      } catch (error) {
        console.error("Error updating task:", error);
        alert("Error updating task. Please try again.");

        // Revert checkbox state on error
        if (e.target.classList.contains("task-checkbox")) {
          e.target.checked = !e.target.checked;
          const taskText = li.querySelector('.task-text');
          if (e.target.checked) {
            taskText.classList.add('completed');
          } else {
            taskText.classList.remove('completed');
          }
        }
      }
    });

    // Allow Enter key to add task
    taskInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        addBtn.click();
      }
    });

    // Add some sample tasks for demonstration (optional - remove if you don't want them)
    document.addEventListener("DOMContentLoaded", () => {
      // Focus on input when page loads
      taskInput.focus();
    });
  </script>

</body>


</html>
