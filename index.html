<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MY To-Do list ❤️</title>
  <link href="style.css" rel="stylesheet">
</head>

<body>
  <div class="container">

    <div class="todolist">
      <h1>
        <img src="icon.jpeg" alt="icon" class="logo"> TO-DO LIST
      </h1>

      <!-- Login/Register -->
      <div id="authContainer">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="registerBtn">Register</button>
        <button id="loginBtn">Login</button>
      </div>

      <!-- Task Box (hidden until user logs in) -->
      <div class="task-box" id="taskBox" style="display:none;">
        <div class="input-row">
          <input type="text" id="taskInput" placeholder="Enter a task">
          <button id="addBtn">Add</button>
        </div>

        <div class="row tasks-and-motivation">
          <ul id="taskList"></ul>

          <div class="motivation">
            <img src="mot.jpeg" alt="Motivational Image">
          </div>

        </div>

        <img id="victoryImg" src="victory.jpeg" alt="Victory!">

      </div>
    </div>
  </div>

  <script type="module">
    // Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBoW7a3NWL0DS5ynJymIrr0gP1hdIa6SXY",
      authDomain: "my-to-d0.firebaseapp.comgit",
      projectId: "my-to-d0",
      storageBucket: "my-to-d0.firebasestorage.app",
      messagingSenderId: "820680960546",
      appId: "1:820680960546:web:60843763935c4d0790787b"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth();

    // DOM elements
    const taskInput = document.getElementById("taskInput");
    const addBtn = document.getElementById("addBtn");
    const taskList = document.getElementById("taskList");
    const victoryImg = document.getElementById('victoryImg');
    const authContainer = document.getElementById("authContainer");
    const taskBox = document.getElementById("taskBox");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const registerBtn = document.getElementById("registerBtn");
    const loginBtn = document.getElementById("loginBtn");

    let tasksCol; // Will be user-specific

    // Register user
    registerBtn.addEventListener("click", () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      createUserWithEmailAndPassword(auth, email, password)
        .then(userCredential => {
          console.log("Registered:", userCredential.user.uid);
        })
        .catch(error => alert(error.message));
    });

    // Login user
    loginBtn.addEventListener("click", () => {
      const email = emailInput.value;
      const password = passwordInput.value;
      signInWithEmailAndPassword(auth, email, password)
        .then(userCredential => {
          console.log("Logged in:", userCredential.user.uid);
        })
        .catch(error => alert(error.message));
    });

    // Monitor authentication state
    onAuthStateChanged(auth, user => {
      if (user) {
        console.log("User signed in:", user.uid);
        authContainer.style.display = "none";
        taskBox.style.display = "block";

        // Tasks collection specific to user
        tasksCol = collection(db, "tasks_" + user.uid);

        // Listen to tasks in real-time
        onSnapshot(tasksCol, snapshot => {
          taskList.innerHTML = "";
          snapshot.forEach(docSnap => {
            const task = docSnap.data();
            const li = document.createElement("li");
            li.dataset.id = docSnap.id;

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.checked = task.completed;
            checkbox.classList.add("task-checkbox");

            const span = document.createElement("span");
            span.textContent = task.text;
            span.classList.add("task-text");
            if (task.completed) span.classList.add("completed");

            const deleteBtn = document.createElement("button");
            deleteBtn.textContent = "X";
            deleteBtn.classList.add("deleteBtn");

            li.appendChild(checkbox);
            li.appendChild(span);
            li.appendChild(deleteBtn);
            taskList.appendChild(li);
          });

          checkVictory();
        });

      } else {
        authContainer.style.display = "block";
        taskBox.style.display = "none";
      }
    });

    // Add task
    addBtn.addEventListener("click", async () => {
      const text = taskInput.value.trim();
      if (!text) return;
      try {
        await addDoc(tasksCol, { text, completed: false, createdAt: serverTimestamp() });
        taskInput.value = "";
      } catch (err) {
        alert("Error adding task: " + err.message);
      }
    });

    // Handle checkbox & delete
    taskList.addEventListener("click", async (e) => {
      const li = e.target.closest("li");
      if (!li) return;
      const id = li.dataset.id;

      try {
        if (e.target.classList.contains("deleteBtn")) {
          await deleteDoc(doc(db, tasksCol.path, id));
        }
        if (e.target.classList.contains("task-checkbox")) {
          const isCompleted = e.target.checked;
          const taskText = li.querySelector('.task-text');
          if (isCompleted) taskText.classList.add("completed");
          else taskText.classList.remove("completed");

          await updateDoc(doc(db, tasksCol.path, id), { completed: isCompleted });
          checkVictory();
        }
      } catch (err) {
        alert("Error updating task: " + err.message);
      }
    });

    // Enter key to add task
    taskInput.addEventListener("keypress", e => { if (e.key === "Enter") addBtn.click(); });

    // Victory check
    function checkVictory() {
      const tasks = document.querySelectorAll('#taskList li');
      const completed = document.querySelectorAll('#taskList li .task-checkbox:checked');
      if (tasks.length > 0 && tasks.length === completed.length) {
        victoryImg.style.display = 'block';
        victoryImg.classList.add('show');
      } else {
        victoryImg.classList.remove('show');
        setTimeout(() => { if (!victoryImg.classList.contains('show')) victoryImg.style.display = 'none'; }, 300);
      }
    }
  </script>
</body>
</html>



